<%inherit file="base.html"/>

<%namespace name="forms" file="/common/forms.html"/>
<%namespace name="blocks" file="/common/blocks.html"/>
<%namespace name="widgets" file="/admin/common/widgets.html"/>
<%namespace name="project_header" file="/admin/common/project_header.html"/>

<%def name="title()">Edit Product ${obj.id}</%def>


${project_header.project_header(obj.project)}


<section class="section-admin-project">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="page-header">Product ${obj.id}</h1>

        ## TODO
        ## - Make production schedule editor work
        ## - Add option editing interface

        ${renderer.begin(id='update-form', class_='form-horizontal form-wrapped js-ajax-validate')}
          ${forms.ltext(renderer, 'name', obj.name)}

          ${forms.ltext(renderer, 'price', obj.price, prefix='$')}
          ${forms.lcheckbox(renderer, 'international_available', obj.international_available, label='International shipping available.')}
          ${forms.ltext(renderer, 'international_surcharge', obj.international_surcharge, prefix='$')}

          ${forms.ltext(renderer, 'gravity', obj.gravity, type='number', hint='Determines the sort order of this product on the project page.')}
          ${forms.lcheckbox(renderer, 'non_physical', obj.non_physical, label='Non-physical item', hint='Check if this product is a non-physical thing, like a donation or a digital copy.')}


          ${forms.lcheckbox(renderer, 'accepts_preorders', obj.accepts_preorders, hint='Check if this product will be available for pre-order or stock orders after crowdfunding.')}
          ${forms.lcheckbox(renderer, 'published', obj.published)}

          <%forms:element label="Production Schedule">
            <table class="table">
              <thead>
                <tr>
                  <th>Delivery Date</th>
                  <th>Qty</th>
                </tr>
              </thead>
              <tbody>
                % for batch in obj.batches:
                  <tr>
                    <td>${batch.ship_date}</td>
                    <td>
                      % if batch.qty:
                        ${batch.qty}
                      % else:
                        Infinite
                      % endif
                    </td>
                  </tr>
                % endfor
              </tbody>
            </table>
          </%forms:element>

          <%forms:element label="SKUs">
            <table class="table">
              <thead>
                <tr>
                  <th>SKU ID</th>
                  <th>Options</th>
                  <th>Qty In Stock</th>
                  <th>Qty Available</th>
                </tr>
              </thead>
              <tbody>
                % for sku in obj.skus:
                  <tr>
                    <td>${sku.id}</td>
                    <td>${blocks.option_value_list(sku)}</td>
                    <td>${sku.qty}</td>
                    <td>${sku.qty_available}</td>
                  </tr>
                % endfor
              </tbody>
            </table>
          </%forms:element>

          ${widgets.images(renderer, obj)}

          <%forms:actions>
            <button class="btn btn-primary" type="submit">Save</button>
            <button class="btn btn-default" type="reset">Cancel</button>
          </%forms:actions>
        ${renderer.end()}
      </div>
    </div>
  </div>
</section>
