<%inherit file="base.html"/>

<%namespace name="forms" file="/common/forms.html"/>

<%def name="title()">Edit Order ${obj.id}</%def>


<section class="section-admin-order">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="page-header">${self.title()}</h1>

        <div class="well">
          <a class="btn btn-default" href="${request.route_path('admin:order-resend', id=obj.id)}">Resend Order Confirmation</a>
        </div>

        ${renderer.begin(id='update-form', class_='form-horizontal form-wrapped')}

          ${forms.ltext(renderer, 'user_id', obj.user_id)}

          ## XXX FIXME

          <%forms:actions>
            <button class="btn btn-primary" type="submit">Save</button>
            <button class="btn btn-default" type="reset">Cancel</button>
          </%forms:actions>
        ${renderer.end()}
      </div>
    </div>
  </div>
</section>


<%def name="address_debug(addr)">
  ${addr.full_name}<br>
  % if addr.company != '':
    ${addr.company}<br>
  % endif
  ${addr.phone}<br>
  ${addr.address1}<br>
  % if addr.address2:
    ${addr.address2}<br>
  % endif
  ${addr.city}, ${addr.state} ${addr.postal_code}<br>
  ${addr.country_name}
</%def>


<section class="section-admin-order-debug">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3>Order Information</h3>
        <p>User: <a href="${request.route_path('admin:user', id=obj.user.id)}">${obj.user_id}</a></p>
        ##<p>Customer Comments: ${obj.customer_comments}</p>

        <h3>Shipping</h3>
        <p>${self.address_debug(obj.shipping)}</p>

        <h3>Items</h3>
        <table>
          % for item in obj.cart.items:
            <tr>
              <td>${item.id}</td>
              <td>${item.product.name} (${item.product.project.name})</td>
              <td>${item.qty_desired}</td>
              <td>${h.currency(item.price_each)}</td>
            </tr>
          % endfor
        </table>

        <h3>Payments</h3>
        % for payment in obj.payments:
          <p>
            ${payment.id}<br>
            ${payment.amount}<br>
            ${payment.created_time}<br>
            % if hasattr(payment, 'method'):
              Method ${payment.method.id}<br>
              Reference ${payment.method.reference}<br>
              ${self.address_debug(payment.method.billing)}
            % endif
          </p>
        % endfor

        <h3>Shipments</h3>
        % for shipment in obj.shipments:
          <p>
            ${shipment.id}<br>
            ${shipment.tracking_num}<br>
            ${h.currency(shipment.cost)}<br>
            ${shipment.created_time}
          </p>
        % endfor
      </div>
    </div>
  </div>
</section>
