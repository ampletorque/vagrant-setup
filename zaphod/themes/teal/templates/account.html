<%inherit file="base.html"/>

<%def name="title()">Account Information</%def>


<section class="section-account">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="text-center">My Account</h1>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        <h3>Account Details</h3>
      </div>
    </div>

    <div class="row">
      <div class="col-md-2">
        ${h.image_or_gravatar(request, request.user, 'large-avatar', default='mm', class_='img-avatar')}
      </div>

      <div class="col-md-10">
        <p>Welcome back, ${request.user.name} (${request.user.email})</p>
        <p>Joined ${h.format_datetime(request, request.user.created_time, '%b %d, %Y')}</p>

        % if request.user.url_path:
          <a class="btn btn-default" href="${request.route_path('profile', path=request.user.url_path)}">View Profile Page</a>
        % endif
        <a class="btn btn-default" href="${request.route_path('settings')}">Edit Account Details</a>
        <a class="btn btn-default" href="https://en.gravatar.com">Update Avatar</a>
        <a class="btn btn-default" href="${request.route_path('logout')}">Sign Out</a>
      </div>
    </div>
  </div>
</section>


<section class="section-account-orders">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3>Projects Backed &amp; Orders</h3>
      </div>
    </div>

    % for order in request.user.orders:
      % for cart_item in order.cart.items:
        <div class="row">
          <div class="col-md-2">
            ## Item image
            ${cart_item.product.img(request, 'product-icon')}
          </div>
          <div class="col-md-10">
            <h4>
              Order ${cart_item.cart.order.id} -
              <a href="${request.node_path(cart_item.product.project)}">${cart_item.product.name}</a> - ${cart_item.product.project.name}
            </h4>
            <p>
              Backed on ${h.format_datetime(request, cart_item.cart.order.created_time, '%b %d, %Y')}<br>
              % if cart_item.shipped_time:
                Shipped on ${h.format_datetime(request, cart_item.shipped_time, '%b %d, %Y')}<br>
                % if cart_item.expected_ship_time:
                  % if cart_item.shipped_time < cart_item.expected_ship_time:
                    <strong>Shipped ${(cart_item.expected_ship_time - cart_item.shipped_time).days} days early!</strong>
                  % else:
                    <strong>Shipped ${(cart_item.shipped_time - cart_item.expected_ship_time).days} days late!</strong>
                  % endif
                  Originally expected to ship on ${h.format_datetime(request, cart_item.expected_ship_time, '%B %Y')}
                % endif
              % elif cart_item.product.non_physical:
                No shipment
              % elif cart_item.batch  and cart_item.expected_ship_time != cart_item.batch.ship_time:
                <strong>This project has fallen behind schedule and is currently expecting to ship on ${h.format_datetime(request, cart_item.batch.ship_time, '%b %d, %Y')}. Please see project updates for more information.</strong><br>
                Originally expected to ship on ${h.format_datetime(request, cart_item.expected_ship_time, '%B %Y')}
              % elif cart_item.expected_ship_time:
                Ships on ${h.format_datetime(request, cart_item.expected_ship_time, '%b %d, %Y')}
              % else:
                Delivery date unknown
              % endif
            </p>
            <p>
              <a href="${request.route_path('order', id=cart_item.cart.order.id)}">View Order Details</a>
            </p>
          </div>
        </div>
      % endfor
    % endfor
  </div>
</section>
