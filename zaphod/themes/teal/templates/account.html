<%inherit file="base.html"/>

<%def name="title()">Account Information</%def>


<section class="section-account">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="text-center">My Account</h1>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        <h3>Account Details</h3>
      </div>
    </div>

    <div class="row">
      <div class="col-md-2">
        ${h.image_or_gravatar(request, request.user, 'large-avatar', default='mm', class_='img-avatar')}
      </div>

      <div class="col-md-10">
        <p>Welcome back, ${request.user.name} (${request.user.email})</p>
        ##<p>Joined Mar 20, 2013</p>

        <a class="btn btn-default" href="${request.route_path('settings')}">Edit Account Details</a>
        <a class="btn btn-default" href="https://en.gravatar.com">Update Avatar</a>
        <a class="btn btn-default" href="${request.route_path('logout')}">Sign Out</a>
      </div>
    </div>
  </div>
</section>


<section class="section-account-orders">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3>Projects Backed &amp; Orders</h3>
      </div>
    </div>

    % for order in request.user.orders:
      % for pledge in order.cart.items:
        <div class="row">
          <div class="col-md-2">
            ## Item image
            ${pledge.pledge_level.img(request, 'pledge-icon')}
          </div>
          <div class="col-md-10">
            <h4>
              Order ${pledge.cart.order.id} -
              <a href="${request.node_path(pledge.pledge_level.project)}">${pledge.pledge_level.name}</a> - ${pledge.pledge_level.project.name}
            </h4>
            <p>
              Backed on ${h.format_datetime(request, pledge.cart.order.created_time, '%b %d, %Y')}<br>
              % if pledge.shipped_date:
                Shipped on ${h.format_datetime(request, pledge.shipped_date, '%b %d, %Y')}<br>
                % if pledge.expected_delivery_date:
                  % if pledge.shipped_date < pledge.expected_delivery_date:
                    <strong>Shipped ${(pledge.expected_delivery_date - pledge.shipped_date).days} days early!</strong>
                  % else:
                    <strong>Shipped ${(pledge.shipped_date - pledge.expected_delivery_date).days} days late!</strong>
                  % endif
                  Originally expected to ship on ${h.format_datetime(request, pledge.expected_delivery_date, '%b %d, %Y')}
                % endif
              % elif pledge.pledge_level.non_physical:
                No shipment
              % elif pledge.batch  and pledge.expected_delivery_date != pledge.batch.delivery_date:
                <strong>This project has fallen behind schedule and is currently expecting to ship on ${h.format_datetime(request, pledge.batch.delivery_date, '%b %d, %Y')}. Please see project updates for more information.</strong><br>
                Originally expected to ship on ${h.format_datetime(request, pledge.expected_delivery_date, '%b %d, %Y')}
              % elif pledge.expected_delivery_date:
                Ships on ${h.format_datetime(request, pledge.expected_delivery_date, '%b %d, %Y')}
              % else:
                Delivery date unknown
              % endif
            </p>
            <p>
              <a href="${request.route_path('order', id=pledge.cart.order.id)}">View Order Details</a>
            </p>
          </div>
        </div>
      % endfor
    % endfor
  </div>
</section>
